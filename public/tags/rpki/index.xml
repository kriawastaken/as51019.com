<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Rpki on AS51019</title>
    <link>http://localhost:1313/tags/rpki/</link>
    <description>Recent content in Rpki on AS51019</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en</language>
    <lastBuildDate>Thu, 02 May 2024 23:27:27 +0000</lastBuildDate><atom:link href="http://localhost:1313/tags/rpki/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>ASPA path validation in BIRD2 with Routinator and TypeScript</title>
      <link>http://localhost:1313/posts/aspa-bird2/</link>
      <pubDate>Thu, 02 May 2024 23:27:27 +0000</pubDate>
      
      <guid>http://localhost:1313/posts/aspa-bird2/</guid>
      <description>&lt;p&gt;Recently (or not so recently?) some RFCs were published on the topic of a new standard in routing security. This is the ASPA (Autonomous System Provider Authorization) Objects system.&lt;/p&gt;
&lt;p&gt;Even more recently &lt;a href=&#34;https://manrs.org/2023/02/unpacking-the-first-route-leak-prevented-by-aspa/&#34;&gt;the first route leak prevented by ASPA&lt;/a&gt; ocurred, in february 2023.&lt;/p&gt;
&lt;p&gt;I thought it might be fun to explore if we could achieve the same thing, only with BIRD2, some open source tools, and a bit of TypeScript. So let&amp;rsquo;s dive in!&lt;/p&gt;</description>
      <content>&lt;p&gt;Recently (or not so recently?) some RFCs were published on the topic of a new standard in routing security. This is the ASPA (Autonomous System Provider Authorization) Objects system.&lt;/p&gt;
&lt;p&gt;Even more recently &lt;a href=&#34;https://manrs.org/2023/02/unpacking-the-first-route-leak-prevented-by-aspa/&#34;&gt;the first route leak prevented by ASPA&lt;/a&gt; ocurred, in february 2023.&lt;/p&gt;
&lt;p&gt;I thought it might be fun to explore if we could achieve the same thing, only with BIRD2, some open source tools, and a bit of TypeScript. So let&amp;rsquo;s dive in!&lt;/p&gt;
&lt;h1 id=&#34;rpki-client&#34;&gt;rpki-client&lt;/h1&gt;
&lt;p&gt;Initially my intuition for this was to use &lt;code&gt;rpki-client&lt;/code&gt; as I had seen this tool used by Job Snijders and other big names in the &amp;ldquo;routing security space&amp;rdquo;.&lt;/p&gt;
&lt;p&gt;The maintainers of &lt;code&gt;rpki-client&lt;/code&gt; also happened to publish &lt;a href=&#34;https://console.rpki-client.org/&#34;&gt;a website&lt;/a&gt; showing dumps given by &lt;code&gt;rpki-client&lt;/code&gt; at certain intervals in a web-accessible form. &lt;a href=&#34;https://console.rpki-client.org/aspa.html&#34;&gt;There even is an ASPA page!&lt;/a&gt;. Cool!&lt;/p&gt;
&lt;p&gt;Unfortunately I only ran into issues with &lt;code&gt;rpki-client&lt;/code&gt;. It&amp;rsquo;d do funky stuff like not being able to connect to most repos and run out of memory, for whatever reason.&lt;/p&gt;
&lt;p&gt;So I changed course.&lt;/p&gt;
&lt;h1 id=&#34;routinator&#34;&gt;Routinator&lt;/h1&gt;
&lt;p&gt;When I was doing this I happened to be in a call in the &lt;a href=&#34;https://discord.gg/ipv6&#34;&gt;Network: IPv6 Discord&lt;/a&gt; where Lee, a comrade from the networking space, pointed out that NLnet&amp;rsquo;s Routinator could do ASPA. Indeed, &lt;a href=&#34;https://routinator.docs.nlnetlabs.nl/en/stable/advanced-features.html#aspa&#34;&gt;it can&lt;/a&gt; though it requires some modification.&lt;/p&gt;
&lt;p&gt;To do this we have to follow &lt;a href=&#34;https://routinator.docs.nlnetlabs.nl/en/stable/building.html&#34;&gt;Routinator&amp;rsquo;s guide for compiling from source&lt;/a&gt;. This is so we can build the software with the feature flag that enables ASPA.&lt;/p&gt;
&lt;p&gt;Luckily this is pretty simple and boils down to running the correct command after installing rust on your system:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# some build tools&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;apt install build-essential
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# install rust (please dont pipe to bash in production)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;curl --proto &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;=https&amp;#39;&lt;/span&gt; --tlsv1.2 -sSf https://sh.rustup.rs | sh
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# add cargo to $PATH (note the period, it&amp;#39;s important)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;. &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;$HOME&lt;span style=&#34;color:#e6db74&#34;&gt;/.cargo/env&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# build routinator with aspa&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cargo install --locked --features aspa routinator
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Now we can run &lt;code&gt;routinator&lt;/code&gt; with the &lt;code&gt;--enable-aspa&lt;/code&gt; flag. Cool!&lt;/p&gt;
&lt;h1 id=&#34;getting-current-aspa-data&#34;&gt;Getting current ASPA data&lt;/h1&gt;
&lt;p&gt;Now, to do anything useful here we have to retrieve all current ASPA ASAs (I think these are like certificates?) from the RPKI publication servers around the world.&lt;/p&gt;
&lt;p&gt;Unfortunately, since this proposed standard is so new (and not even accepted yet - for the record) there exists no TCP transport mechanism (and certainly no implementation for it in BIRD2) to import ASPA data into a routing daemon. Instead we&amp;rsquo;ll have to move the data ourselves and make it work with BIRD2 ourselves.&lt;/p&gt;
&lt;p&gt;Routinator makes this &lt;em&gt;really easy&lt;/em&gt; and lets us output to JSON, just what we need to do some scripting with Deno later:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;routinator --enable-aspa vrps -f json -o dump.json --no-route-origins --no-router-keys
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;What&amp;rsquo;s happening here is quite simple. We run &lt;code&gt;routinator&lt;/code&gt; with the &lt;code&gt;--enable-aspa&lt;/code&gt; flag to use ASPA features. Then we run the &lt;code&gt;vrps&lt;/code&gt; subcommand and pass the following options to it:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;-f json&lt;/code&gt; - output to JSON format.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-o dump.json&lt;/code&gt; - write the output to a new file called &lt;code&gt;dump.json&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--no-route-origins&lt;/code&gt; exclude ROAs..&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--no-router-keys&lt;/code&gt; exclude router keys.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;This command does take a while to run, so it probably fits in nicely as a cronjob. But once it finishes we get a file that looks &lt;a href=&#34;http://localhost:1313/posts/aspa-bird2/dump.json&#34;&gt;something like this&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Now we just have to use it.&lt;/p&gt;
&lt;h1 id=&#34;writing-a-filter-function-for-bird2&#34;&gt;Writing a filter function for BIRD2&lt;/h1&gt;
&lt;p&gt;I&amp;rsquo;ll be the first to admit to being no BIRD expert but I do have a few tricks up my sleeve. AS path filtering is one of them.&lt;/p&gt;
&lt;p&gt;The filter (or I guess conditional) that makes what I want to achieve possible is the following:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;bgp_path ~ [= * ASN * =]
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;In summary it will return true if the specified ASN exists within the AS path. You can also pass multiple ASNs to it and check for order:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;bgp_path ~ [= * ASN1 ASN2 * =] )
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;In this example, &lt;code&gt;ASN1&lt;/code&gt; would be &lt;code&gt;ASN2&lt;/code&gt;&amp;rsquo;s permitted carrier (&amp;ldquo;provider&amp;rdquo; in ASPA speak).&lt;/p&gt;
&lt;p&gt;Using these two conditions we can quite easily create a functional, but rather sloppy, filter function for published ASAs.&lt;/p&gt;
&lt;p&gt;The pseudocode looks a little like this:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;boolean&lt;/span&gt; is aspa &lt;span style=&#34;color:#a6e22e&#34;&gt;valid&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (asa publisher asn in path) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (provider1 asn before asa publisher asn in path) &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (provider2 asn before asa publisher asn in path) &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (providerN asn before asa publisher asn in path) &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;; 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;I&amp;rsquo;m sure this code could be improved for performance and efficiency - my online mates already seem to think so - but this will work for our purposes for now.&lt;/p&gt;
&lt;h1 id=&#34;generating-the-filter-function&#34;&gt;Generating the filter function&lt;/h1&gt;
&lt;p&gt;I chose to write &lt;a href=&#34;https://github.com/kjartanhr/routinator-aspa-json-to-bird2&#34;&gt;a TypeScript program&lt;/a&gt; with Deno to achieve what I&amp;rsquo;d like to do here. Deno also conveniently allows you to &amp;ldquo;compile&amp;rdquo; (really it&amp;rsquo;s just bundling) the program to a binary that can run portably, which is handy. Though the binary does end up being around 130MB in size. Yikes!&lt;/p&gt;
&lt;p&gt;The program&amp;rsquo;s 100~ lines come mostly from error handling and CLI flag boilerplate. The actual logic is 14 lines consisting of a for loop with a nested one inside it:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-typescript&#34; data-lang=&#34;typescript&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;let&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;txt&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; {&lt;span style=&#34;color:#a6e22e&#34;&gt;customer&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;providers&lt;/span&gt;} &lt;span style=&#34;color:#66d9ef&#34;&gt;of&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;aspas&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;asn&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;customer&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;replace&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;LEADING_AS&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;txt&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;`   # does the AS path include &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;${&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;customer&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;?&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;\&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;n`&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;txt&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;`   if (bgp_path ~ [= * &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;${&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;asn&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt; * =]) then {&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;\&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;n`&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;txt&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;`       # does the AS path include [carrier&amp;#39;s asn, &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;${&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;customer&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;]?&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;\&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;n`&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;provider&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;of&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;providers&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;carrier&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;provider&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;replace&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;LEADING_AS&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#a6e22e&#34;&gt;txt&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;`       if (bgp_path ~ [= * &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;${&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;carrier&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;${&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;asn&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt; * =]) then return true;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;\&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;n`&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;txt&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;       return false;\n&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;txt&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;   }\n\n&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;There are a few more lines of boilerplate but you get the gist. The resulting function definition you get from running the program looks a little like this:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;function is_aspa_valid () {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   # does the &lt;span style=&#34;color:#66d9ef&#34;&gt;AS&lt;/span&gt; path include &lt;span style=&#34;color:#66d9ef&#34;&gt;AS945&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (bgp_path &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; [&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;945&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;]) then {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       # does the &lt;span style=&#34;color:#66d9ef&#34;&gt;AS&lt;/span&gt; path include [carrier&lt;span style=&#34;color:#a6e22e&#34;&gt;&amp;#39;s&lt;/span&gt; asn, &lt;span style=&#34;color:#66d9ef&#34;&gt;AS945&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (bgp_path &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; [&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;174&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;945&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;]) then &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (bgp_path &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; [&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1299&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;945&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;]) then &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (bgp_path &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; [&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3491&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;945&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;]) then &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (bgp_path &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; [&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;6461&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;945&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;]) then &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (bgp_path &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; [&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;6939&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;945&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;]) then &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (bgp_path &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; [&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;7018&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;945&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;]) then &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (bgp_path &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; [&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;7922&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;945&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;]) then &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (bgp_path &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; [&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;9002&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;945&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;]) then &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (bgp_path &lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt; [&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;32097&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;945&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;]) then &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   &lt;span style=&#34;color:#f92672&#34;&gt;..&lt;/span&gt;.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   # to avoid breaking stuff, assume the path is valid &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; no &lt;span style=&#34;color:#66d9ef&#34;&gt;ASA&lt;/span&gt; exists.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;With that, using the generated function is as easy as shoving it in a &lt;code&gt;/etc/bird/functions/aspa.conf&lt;/code&gt; file, including it in &lt;code&gt;bird.conf&lt;/code&gt; and using it for filtering!&lt;/p&gt;
&lt;p&gt;Using the function should look a little like this:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-conf&#34; data-lang=&#34;conf&#34;&gt;if (!is_aspa_valid()) then reject &amp;#34;aspa: not ok&amp;#34;;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Typing &lt;code&gt;birdc c&lt;/code&gt; to reconfigure BIRD is a little underwhelming, though. Barely anyone publishes ASAs currently and the few that are won&amp;rsquo;t be likely to push out ASPA invalid routes any time soon. Once in a while we might find a route leak prevented by this system but it won&amp;rsquo;t be much for a &lt;em&gt;while&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;However, to have some fun, we can just poke at the ASPA function and comment out a few key lines. For example: during testing I removed the line permitting Hurricane Electric, AS6939, to carry AS945&amp;rsquo;s routes. The result was successful in that it removed any routes from AS945 with AS6939 in the AS path from BIRDs version of the &amp;ldquo;RIB&amp;rdquo;.&lt;/p&gt;
&lt;h1 id=&#34;closing&#34;&gt;Closing&lt;/h1&gt;
&lt;p&gt;I think this was a fun evening project. It didn&amp;rsquo;t take too long and was pretty satisfying. It also taught me a bit about ASPA that I didn&amp;rsquo;t know before.&lt;/p&gt;
&lt;p&gt;If you&amp;rsquo;d like to do this for yourself I&amp;rsquo;d like to reiterate that ASPA is an incredibly new and unapproved standard that will undoubtedly change. I wouldn&amp;rsquo;t do this in production quite yet. Regardless I &lt;a href=&#34;https://github.com/kjartanhr/routinator-aspa-json-to-bird2&#34;&gt;published my program on GitHub&lt;/a&gt; and I encourage you, if you have any improvements, to make a pull request &lt;img src=&#34;http://localhost:1313/owiehappy.png&#34; alt=&#34;:owiehappy:&#34; height=&#34;24&#34; style=&#34;display:inline-block;margin-bottom:-8px;margin-left:-3px;&#34; /&gt;&lt;/p&gt;
&lt;h1 id=&#34;some-references&#34;&gt;Some references&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://console.rpki-client.org/&#34;&gt;rpki-client console&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://routinator.docs.nlnetlabs.nl/en/stable/&#34;&gt;Routinator&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;questionscomments&#34;&gt;Questions/comments&lt;/h1&gt;
&lt;p&gt;If you&amp;rsquo;d like to ask me something or have a comment I&amp;rsquo;d be happy chat via &lt;a href=&#34;mailto:kjartann@kjartann.is&#34;&gt;kjartann@kjartann.is&lt;/a&gt;.&lt;/p&gt;
&lt;img src=&#34;http://localhost:1313/owiehappy.gif&#34; alt=&#34;:owiehappy: emoji&#34; width=&#34;48&#34; /&gt;
</content>
    </item>
    
  </channel>
</rss>
